<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Ethfoo&#39;s Blog</title>
        <link>http://example.org/</link>
        <description>Ethfoo&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><managingEditor>ethfoo@163.com (ethfoo)</managingEditor>
            <webMaster>ethfoo@163.com (ethfoo)</webMaster><lastBuildDate>Wed, 01 Jul 2020 21:40:32 &#43;0800</lastBuildDate>
            <atom:link href="http://example.org/index.xml" rel="self" type="application/rss+xml" />
        <item>
    <title>ä»HPAåˆ°KPAï¼šKnativeè‡ªåŠ¨æ‰©ç¼©å®¹æ·±åº¦åˆ†æ</title>
    <link>http://example.org/posts/serverless/knative%E4%B9%8B%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9%E5%AE%B9/</link>
    <pubDate>Wed, 01 Jul 2020 21:40:32 &#43;0800</pubDate>
    <author>Author</author>
    <guid>http://example.org/posts/serverless/knative%E4%B9%8B%E8%87%AA%E5%8A%A8%E6%89%A9%E7%BC%A9%E5%AE%B9/</guid>
    <description><![CDATA[ä¸Šç¯‡æ–‡ç« ä¸»è¦èŠçš„æ˜¯æµé‡å’Œç½‘ç»œé—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬æ¢è®¨ä¸€ä¸‹å¦å¤–ä¸€ä¸ªKnativeçš„æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨æ‰©ç¼©å®¹ã€‚æœ¬æ–‡åªæ‰“ç®—å›´ç»•ä¸€ä¸ªæ ¸å¿ƒçš„é—®é¢˜è¿›è¡Œæ·±å…¥åˆ†æï¼Œå³å¦‚ä½•è®¾è®¡ä¸€ä¸ªè‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿï¼Œä»¥åŠKnativeåˆæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
å¦‚ä½•è®¾è®¡ä¸€ä¸ªè‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿ  è‡ªåŠ¨æ‰©ç¼©å®¹å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹å¹¿ä¹‰çš„æ¦‚å¿µï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³æ³¨æœåŠ¡å‰¯æœ¬æ•°çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œé›†ç¾¤æ‰©ç¼©å®¹å’ŒVPAåˆ™ä¸ä¼šæ¶‰åŠã€‚
 å‡è®¾ä¸€ä¸‹ï¼Œå¦‚æœè®©æˆ‘ä»¬è‡ªç ”ä¸€ä¸ªå®Œå–„çš„è‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿï¼Œä¼šå¦‚ä½•å»å®ç°å‘¢ï¼Ÿé¦–å…ˆå¤§è‡´å¯ä»¥å°†è¦è§£å†³çš„é—®é¢˜æŠ½è±¡æˆä»¥ä¸‹å‡ ç‚¹ï¼š
 æœ‰å“ªäº›Metricsæ•°æ®æ¥å†³å®šæ‰©ç¼©å®¹ï¼Ÿ å¦‚ä½•é‡‡é›†è¿™äº›Metricsæ•°æ®ï¼Ÿ å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆç†çš„è‡ªåŠ¨æ‰©ç¼©å®¹ç®—æ³•ï¼Ÿ  åœ¨Kubernetesé›†ç¾¤ä¸‹çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œå¾ˆå¤šäººé©¬ä¸Šä¼šè”æƒ³åˆ°HPAï¼Œå¦‚æœåŸºäºHPAæ¥è®¾è®¡ä¸€ä¸ªè‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿï¼Œä¼šé¢ä¸´ä»€ä¹ˆæ ·çš„æŒ‘æˆ˜ï¼Ÿ
1. æœ‰å“ªäº›Metricsæ•°æ® HPA v1ç‰ˆæœ¬å¯ä»¥æ ¹æ®æœåŠ¡çš„CPUä½¿ç”¨ç‡æ¥è¿›è¡Œè‡ªåŠ¨æ‰©ç¼©å®¹ã€‚ä½†æ˜¯å¹¶éæ‰€æœ‰çš„ç³»ç»Ÿéƒ½å¯ä»¥ä»…ä¾é CPUæˆ–è€…MemoryæŒ‡æ ‡æ¥æ‰©å®¹ï¼Œå¯¹äºå¤§å¤šæ•° Web åº”ç”¨çš„åç«¯æ¥è¯´ï¼ŒåŸºäºæ¯ç§’çš„è¯·æ±‚æ•°é‡è¿›è¡Œå¼¹æ€§ä¼¸ç¼©æ¥å¤„ç†çªå‘æµé‡ä¼šæ›´åŠ çš„é è°±ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ªè‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿæ¥è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½å±€é™äºCPUã€MemoryåŸºç¡€ç›‘æ§æ•°æ®ï¼Œæ¯ç§’è¯·æ±‚æ•°RPSç­‰è‡ªå®šä¹‰æŒ‡æ ‡ä¹Ÿæ˜¯ååˆ†é‡è¦ã€‚
å¹¸è¿çš„æ˜¯ï¼ŒHPA V2ç‰ˆæœ¬å·²ç»æ”¯æŒcustom Metricsè‡ªå®šä¹‰æŒ‡æ ‡ã€‚ Custom Metricså…¶å®åªæ˜¯ä¸€ä¸ªKubernetesçš„æ¥å£ï¼Œå®é™…Metricsæ•°æ®çš„æä¾›ï¼Œéœ€è¦é¢å¤–çš„æ‰©å±•å®ç°ï¼Œå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªï¼ˆå‚è€ƒï¼šhttps://github.com/kubernetes-sigs/custom-Metrics-apiserverï¼‰æˆ–è€…ä½¿ç”¨å¼€æºçš„Prometheus adapterã€‚å¦‚æœè‡ªå·±å®ç°custom-Metricsï¼Œå¯ä»¥è‡ªå®šä¹‰å„ç§MetricsæŒ‡æ ‡ï¼Œä½¿ç”¨Prometheus adapteråˆ™å¯ä»¥ä½¿ç”¨Prometheusä¸­ç°æœ‰çš„ä¸€äº›æŒ‡æ ‡æ•°æ®ã€‚
2. å¦‚ä½•é‡‡é›†Metricsæ•°æ® å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿé»˜è®¤ä¾èµ–Prometheusï¼Œè‡ªå®šä¹‰çš„MetricsæŒ‡æ ‡åˆ™å¯ä»¥ä»å„ç§æ•°æ®æºæˆ–è€…exporterä¸­è·å–ï¼ŒåŸºäºæ‹‰æ¨¡å‹çš„Prometheusä¼šå®šæœŸä»æ•°æ®æºä¸­æ‹‰å–æ•°æ®ã€‚
å‡è®¾æˆ‘ä»¬ä¼˜å…ˆé‡‡ç”¨RPSæŒ‡æ ‡ä½œä¸ºç³»ç»Ÿçš„é»˜è®¤Metricsæ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ä»ç½‘å…³é‡‡é›†æˆ–è€…ä½¿ç”¨æ³¨å…¥Envoy sidecarç­‰æ–¹å¼è·å–å·¥ä½œè´Ÿè½½çš„æµé‡æŒ‡æ ‡ã€‚
3. å¦‚ä½•è‡ªåŠ¨æ‰©ç¼©å®¹ K8sçš„HPA controllerå·²ç»å®ç°äº†ä¸€å¥—ç®€å•çš„è‡ªåŠ¨æ‰©ç¼©å®¹é€»è¾‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯30sæ£€æµ‹ä¸€æ¬¡æŒ‡æ ‡ï¼Œåªè¦æ£€æµ‹åˆ°äº†é…ç½®HPAçš„ç›®æ ‡å€¼ï¼Œåˆ™ä¼šè®¡ç®—å‡ºé¢„æœŸçš„å·¥ä½œè´Ÿè½½çš„å‰¯æœ¬æ•°ï¼Œå†è¿›è¡Œæ‰©ç¼©å®¹æ“ä½œã€‚åŒæ—¶ï¼Œä¸ºäº†é¿å…è¿‡äºé¢‘ç¹çš„æ‰©ç¼©å®¹ï¼Œé»˜è®¤åœ¨5minå†…æ²¡æœ‰é‡æ–°æ‰©ç¼©å®¹çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè§¦å‘æ‰©ç¼©å®¹ã€‚
ä¸è¿‡ï¼ŒHPAæœ¬èº«çš„ç®—æ³•ç›¸å¯¹æ¯”è¾ƒä¿å®ˆï¼Œå¯èƒ½å¹¶ä¸é€‚ç”¨äºå¾ˆå¤šåœºæ™¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¿«é€Ÿçš„æµé‡çªå‘åœºæ™¯ï¼Œå¦‚æœæ­£å¤„åœ¨5minå†…çš„HPAç¨³å®šæœŸï¼Œè¿™ä¸ªæ—¶å€™æ ¹æ®HPAçš„ç­–ç•¥ï¼Œä¼šå¯¼è‡´æ— æ³•æ‰©å®¹ã€‚ å¦å¤–ï¼Œåœ¨ä¸€äº›Serverlessåœºæ™¯ä¸‹ï¼Œæœ‰ç¼©å®¹åˆ°0ç„¶åå†·å¯åŠ¨çš„éœ€æ±‚ï¼Œä½†HPAé»˜è®¤ä¸æ”¯æŒã€‚
 å…³äºHPAæ”¯æŒç¼©å®¹è‡³0çš„è®¨è®ºï¼Œå¯ä»¥å‚è€ƒissuesï¼ˆhttps://github.com/kubernetes/kubernetes/issues/69687ï¼‰ï¼Œè¯¥PRï¼ˆhttps://github.com/kubernetes/kubernetes/pull/74526ï¼‰å·²ç»è¢«mergeï¼Œåé¢çš„ç‰ˆæœ¬å¯ä»¥é€šè¿‡featureGateè®¾ç½®å¼€å¯ï¼Œä¸è¿‡è¯¥åŠŸèƒ½æ˜¯å¦åº”è¯¥ç”±K8sæœ¬èº«å»å®ç°ï¼Œç¤¾åŒºä»ç„¶å­˜åœ¨ä¸€äº›äº‰è®®ã€‚
 å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿè¦å®ç°æ”¯æŒç¼©å®¹è‡³0å’Œå†·å¯åŠ¨çš„åŠŸèƒ½ï¼Œå¹¶åœ¨ç”Ÿäº§ç¯å¢ƒçœŸæ­£å¯ç”¨çš„è¯ï¼Œåˆ™éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€‚ä¾‹å¦‚HPAæ˜¯å®šæ—¶æ‹‰å–Metricsæ•°æ®å†å†³å®šæ˜¯å¦æ‰©å®¹ï¼Œä½†è¿™ä¸ªæ—¶é—´é—´éš”å³ä½¿æ”¹æˆ1sçš„è¯ï¼Œå¯¹äºå†·å¯åŠ¨æ¥è¯´è¿˜æ˜¯å¤ªé•¿ï¼Œéœ€è¦ç±»ä¼¼æ¨é€çš„æœºåˆ¶æ‰èƒ½é¿å…å»¶è¿Ÿã€‚
æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœåŸºäºç°æœ‰çš„HPAæ¥å®ç°ä¸€å¥—Serverlessè‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨æµé‡ä½œä¸ºæ‰©ç¼©å®¹æŒ‡æ ‡ï¼Œå¤§è‡´éœ€è¦ï¼š
 è€ƒè™‘ä½¿ç”¨ç½‘å…³ç­‰æµé‡å…¥å£æ¥å®ç°æµé‡Metricsçš„æŒ‡æ ‡æ£€æµ‹ï¼Œå¹¶æš´éœ²å‡ºæ¥å£ï¼Œä¾›Prometheusæˆ–è€…è‡ªç ”ç»„ä»¶æ¥é‡‡é›†ã€‚ ä½¿ç”¨Prometheus adapteræˆ–è€…è‡ªç ”Custom Metricsçš„K8sæ¥å£å®ç°ï¼Œä½¿å¾—HPA controllerå¯ä»¥è·å–åˆ°å…·ä½“çš„Metricsæ•°æ®ã€‚  è¿™æ ·ä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨HPAçš„åŠŸèƒ½ï¼Œå®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„è‡ªåŠ¨æ‰©ç¼©å®¹ç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”è¾ƒæ£˜æ‰‹çš„æ˜¯ï¼š
 HPAæ— æ³•ç¼©å®¹è‡³0ï¼Œä¹Ÿæ— æ³•å®ç°å·¥ä½œè´Ÿè½½çš„å†·å¯åŠ¨ã€‚ HPAçš„æ‰©å®¹ç®—æ³•ä¸ä¸€å®šé€‚ç”¨æµé‡çªå‘åœºæ™¯ï¼Œå­˜åœ¨ä¸€å®šçš„éšæ‚£ã€‚  æˆ‘ä»¬æ¥ä¸‹æ¥ä¸€èµ·æ¢ç©¶ä¸€ä¸‹Knativeçš„å®ç°ï¼Œä»¥åŠæ€è€ƒä¸ºä»€ä¹ˆKnativeè¦è¿™ä¹ˆè®¾è®¡ï¼Œæ˜¯ä¸æ˜¯æœ‰æ›´å¥½æ›´ä¼˜é›…çš„æ–¹æ¡ˆå‘¢ï¼Ÿ
Knativeçš„è‡ªåŠ¨æ‰©ç¼©å®¹å®ç° Knativeç›¸å…³ç»„ä»¶ è¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒæ•°æ®é¢çš„ç»„ä»¶ï¼š Queue-proxy é’ˆå¯¹æ¯ä¸ªä¸šåŠ¡å®¹å™¨Knativeéƒ½ä¼šè‡ªåŠ¨æ³¨å…¥ä¸€ä¸ªsidecarå®¹å™¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºGolangçš„åå‘ä»£ç†æœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ£€æµ‹æµé‡ï¼Œæš´éœ²å‡ºRPSå’Œconcurrencyæ•°æ®ä¾›Autoscalerç»„ä»¶é‡‡é›†ã€‚å¦å¤–ï¼Œå¦‚æœç”¨æˆ·é…ç½®containerConcurrencyï¼Œè¿˜ä¼šé™åˆ¶å•ä¸ªå®¹å™¨çš„å¹¶å‘è¯·æ±‚æ•°ï¼Œè¶…è¿‡å¹¶å‘æ•°çš„è¯·æ±‚ï¼Œä¼šè¢«ç¼“å­˜ä¸‹æ¥æ”¾å…¥é˜Ÿåˆ—ï¼Œè¿™ä¹Ÿæ˜¯Queue-proxyåç§°çš„å«ä¹‰ã€‚
Autoscaler Autoscaleræ˜¯è‡ªåŠ¨æ‰©ç¼©å®¹çš„æ ¸å¿ƒæ§åˆ¶ç»„ä»¶ï¼Œä¸»è¦åŠŸèƒ½æ˜¯é‡‡é›†Queue-proxyçš„Metricsæ•°æ®ï¼Œç„¶åå¯¹æ¯”é…ç½®çš„æ•°æ®ï¼Œè®¡ç®—å‡ºé¢„æœŸçš„å‰¯æœ¬æ•°ï¼Œæœ€åè¿›è¡Œæ‰©ç¼©å®¹æ“ä½œã€‚
Activator Activatorçš„å¼•å…¥ï¼Œæœ€å¼€å§‹çš„ç›®çš„æ˜¯åœ¨å†·å¯åŠ¨çš„æ—¶å€™ï¼Œç”±äºæœåŠ¡å‰¯æœ¬æ•°ä¸º0ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç»„ä»¶æ¥ä¿æŒä½è¯·æ±‚ï¼Œé€šçŸ¥Autoscaleræ‰©å®¹å¯¹åº”çš„æœåŠ¡ï¼Œç„¶åå†å°†è¯·æ±‚å‘é€è‡³è¿è¡Œåçš„æœåŠ¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æ‰¿æ‹…äº†å½“æµé‡ç¬é—´çªå¢çš„æ—¶å€™ï¼Œç¼“å­˜è¯·æ±‚ï¼Œç­‰æ‰©å®¹å®Œæˆåå†ä»£ç†å‘é€è‡³åç«¯æœåŠ¡çš„åŠŸèƒ½ã€‚
æœ‰å“ªäº›Metricsæ•°æ®? HPAçš„Metricsæ¥æºä¸€èˆ¬æ˜¯Podçš„CPUæˆ–è€…Memoryï¼Œå½“ç„¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰çš„Metricsæ•°æ®ï¼Œä¸è¿‡å¯¹äºå¤§éƒ¨åˆ†åœ¨çº¿ä¸šåŠ¡æ¥è¯´ï¼Œå¹¶éCPUå¯†é›†å‹ï¼Œè€Œæ˜¯IOå¯†é›†å‹ï¼Œè¿™æ„å‘³ç€å•çº¯ä¾èµ–CPUæ¥è‡ªåŠ¨æ‰©ç¼©å®¹å¾€å¾€å¹¶ä¸æ»¡è¶³å®é™…éœ€æ±‚ï¼Œå¯èƒ½å·¥ä½œè´Ÿè½½æ¥æ”¶çš„æµé‡å·²ç»å¾ˆå¤§äº†ï¼Œå»¶è¿Ÿå·²ç»å¾ˆé«˜äº†ï¼Œä½†æ˜¯HPAè¿˜æ²¡æœ‰å¸®æˆ‘ä»¬æ‰©å®¹æœåŠ¡ã€‚
ä¸ºäº†æ›´å¥½çš„æ»¡è¶³è¿™ç§æƒ…å†µï¼ŒKnative KPAè‡ªåŠ¨æ‰©ç¼©å®¹åˆ™è®¾è®¡æ”¯æŒäº†è¯·æ±‚å¹¶å‘ï¼ˆconcurrencyï¼‰å’ŒRPSï¼ˆrequest-per-secondï¼‰ä¸¤ç§Metricsæ•°æ®ï¼Œç›¸æ¯”CPUæ•°æ®ï¼Œè¿™ä¸¤è€…æ›´è´´è¿‘è´Ÿè½½çš„loadï¼Œæ›´é€‚åˆæè¿°åœ¨çº¿ä¸šåŠ¡ã€‚æ•°æ®æºæ¥è‡ªActivatorç»„ä»¶å’Œæ¯ä¸ªå·¥ä½œè´Ÿè½½Podï¼Œå½“ç„¶å·¥ä½œè´Ÿè½½çš„Podæ•°æ®ç”±Queue-proxy sidecaræš´éœ²å‡ºMetricsæ¥å£ã€‚
RPSæ¯”è¾ƒå¥½ç†è§£ï¼Œåœ¨ä¸€ä¸ªé‡‡é›†å‘¨æœŸå†…ï¼ˆé»˜è®¤1sï¼‰ï¼Œæ¥ä¸€æ¬¡http requestï¼Œè®¡æ•°åŠ 1å³å¯ï¼Œæ¯”å¦‚1så†…æ£€æµ‹åˆ°æ¥äº†100ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆRPSå°±æ˜¯100ã€‚ Concurrencyå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé‡‡é›†å‘¨æœŸå†…æ­£åœ¨å¤„ç†http requestçš„æ•°é‡ï¼Œæ¯”å¦‚1så†…æœ‰50ä¸ªè¯·æ±‚æ­£åœ¨è¢«å¤„ç†åˆ™Concurrencyä¸º50ã€‚å®é™…ä¸ŠKnativeä¼šè®°å½•requestæ¥çš„æ—¶åˆ»å’Œè¿”å›çš„æ—¶åˆ»ï¼Œå¦‚æœ1så†…åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”å¤„ç†äº†500mså³è¿”å›ï¼Œåˆ™Concurrencyä¸º0.]]></description>
</item><item>
    <title>åŸºäºGolangçš„äº‘åŸç”Ÿæ—¥å¿—é‡‡é›†æœåŠ¡è®¾è®¡ä¸å®è·µ</title>
    <link>http://example.org/posts/logging/%E5%9F%BA%E4%BA%8Egolang%E7%9A%84%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5/</link>
    <pubDate>Thu, 12 Mar 2020 20:24:44 &#43;0800</pubDate>
    <author>Author</author>
    <guid>http://example.org/posts/logging/%E5%9F%BA%E4%BA%8Egolang%E7%9A%84%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5/</guid>
    <description><![CDATA[æœ¬æ–‡åŸºäºç¬”è€… 2019 Golang meetup æ­å·ç«™åˆ†äº«æ•´ç†
 ä¸€ã€èƒŒæ™¯ äº‘åŸç”ŸæŠ€æœ¯å¤§æ½®å·²ç»æ¥ä¸´ï¼ŒæŠ€æœ¯å˜é©è¿«åœ¨çœ‰ç«ã€‚
åœ¨è¿™è‚¡æŠ€æœ¯æ½®æµä¹‹ä¸­ï¼Œç½‘æ˜“æ¨å‡ºäº†è½»èˆŸå¾®æœåŠ¡äº‘å¹³å°ï¼Œé›†æˆäº†å¾®æœåŠ¡ã€Servicemeshã€å®¹å™¨äº‘ã€DevOpsç­‰ï¼Œå·²ç»å¹¿æ³›åº”ç”¨äºå…¬å¸é›†å›¢å†…éƒ¨ï¼ŒåŒæ—¶ä¹Ÿæ”¯æ’‘äº†å¾ˆå¤šå¤–éƒ¨å®¢æˆ·çš„äº‘åŸç”ŸåŒ–æ”¹é€ å’Œè¿ç§»ã€‚
åœ¨è¿™å…¶ä¸­ï¼Œæ—¥å¿—æ˜¯å¹³æ—¶å¾ˆå®¹æ˜“è¢«äººå¿½è§†çš„ä¸€éƒ¨åˆ†ï¼Œå´æ˜¯å¾®æœåŠ¡ã€DevOpsçš„é‡è¦ä¸€ç¯ã€‚æ²¡æœ‰æ—¥å¿—ï¼ŒæœåŠ¡é—®é¢˜æ’æŸ¥æ— ä»è°ˆèµ·ï¼ŒåŒæ—¶æ—¥å¿—çš„ç»Ÿä¸€é‡‡é›†ä¹Ÿæ˜¯å¾ˆå¤šä¸šåŠ¡æ•°æ®åˆ†æã€å¤„ç†ã€å®¡è®¡çš„åŸºç¡€ã€‚
ä½†æ˜¯åœ¨äº‘åŸç”Ÿå®¹å™¨åŒ–ç¯å¢ƒä¸‹ï¼Œæ—¥å¿—çš„é‡‡é›†åˆå˜å¾—æœ‰ç‚¹ä¸åŒã€‚
äºŒã€å®¹å™¨æ—¥å¿—é‡‡é›†çš„ç—›ç‚¹ ä¼ ç»Ÿä¸»æœºæ¨¡å¼ å¯¹äºä¼ ç»Ÿçš„ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºéƒ¨ç½²çš„æœåŠ¡ï¼Œæ—¥å¿—é‡‡é›†å·¥ä½œæ¸…æ™°æ˜äº†ã€‚
ä¸šåŠ¡æ—¥å¿—ç›´æ¥è¾“å‡ºåˆ°å®¿ä¸»æœºä¸Šï¼ŒæœåŠ¡è¿è¡Œåœ¨å›ºå®šçš„èŠ‚ç‚¹ä¸Šï¼Œæ‰‹åŠ¨æˆ–è€…æ‹¿è‡ªåŠ¨åŒ–å·¥å…·æŠŠæ—¥å¿—é‡‡é›†agentéƒ¨ç½²åœ¨èŠ‚ç‚¹ä¸Šï¼ŒåŠ ä¸€ä¸‹agentçš„é…ç½®ï¼Œç„¶åå°±å¯ä»¥å¼€å§‹é‡‡é›†æ—¥å¿—äº†ã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿åç»­çš„æ—¥å¿—é…ç½®ä¿®æ”¹ï¼Œè¿˜å¯ä»¥å¼•å…¥ä¸€ä¸ªé…ç½®ä¸­å¿ƒï¼Œç”¨æ¥ä¸‹å‘agenté…ç½®ã€‚
Kubernetesç¯å¢ƒ è€Œåœ¨Kubernetesç¯å¢ƒä¸­ï¼Œæƒ…å†µå°±æ²¡è¿™ä¹ˆç®€å•äº†ã€‚
ä¸€ä¸ªKubernetes nodeèŠ‚ç‚¹ä¸Šæœ‰å¾ˆå¤šä¸åŒæœåŠ¡çš„å®¹å™¨åœ¨è¿è¡Œï¼Œå®¹å™¨çš„æ—¥å¿—å­˜å‚¨æ–¹å¼æœ‰å¾ˆå¤šä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚stdoutã€hostPathã€emptyDirã€pvç­‰ã€‚ç”±äºåœ¨Kubernetesé›†ç¾¤ä¸­ç»å¸¸å­˜åœ¨Podä¸»åŠ¨æˆ–è€…è¢«åŠ¨çš„è¿ç§»ï¼Œé¢‘ç¹çš„é”€æ¯ã€åˆ›å»ºï¼Œæˆ‘ä»¬æ— æ³•å’Œä¼ ç»Ÿçš„æ–¹å¼ä¸€æ ·äººä¸ºçš„ç»™æ¯ä¸ªæœåŠ¡ä¸‹å‘æ—¥å¿—é‡‡é›†é…ç½®ã€‚å¦å¤–ï¼Œç”±äºæ—¥å¿—æ•°æ®é‡‡é›†åä¼šè¢«é›†ä¸­å­˜å‚¨ï¼Œæ‰€ä»¥æŸ¥è¯¢æ—¥å¿—æ—¶ï¼Œå¯ä»¥æ ¹æ®namespaceã€podã€containerã€nodeï¼Œç”šè‡³åŒ…æ‹¬å®¹å™¨çš„ç¯å¢ƒå˜é‡ã€labelç­‰ç»´åº¦æ¥æ£€ç´¢ã€è¿‡æ»¤å¾ˆé‡è¦ã€‚
ä»¥ä¸Šéƒ½æ˜¯æœ‰åˆ«äºä¼ ç»Ÿæ—¥å¿—é‡‡é›†é…ç½®æ–¹å¼çš„éœ€æ±‚å’Œç—›ç‚¹ï¼Œç©¶å…¶åŸå› ï¼Œè¿˜æ˜¯å› ä¸ºä¼ ç»Ÿçš„æ–¹å¼è„±ç¦»äº†Kubernetesï¼Œæ— æ³•æ„ŸçŸ¥Kubernetesï¼Œæ›´æ— æ³•å’ŒKubernetesé›†æˆã€‚
éšç€æœ€è¿‘å‡ å¹´çš„è¿…é€Ÿå‘å±•ï¼ŒKuberneteså·²ç»æˆä¸ºå®¹å™¨ç¼–æ’çš„äº‹å®æ ‡å‡†ï¼Œç”šè‡³å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ–°ä¸€ä»£çš„åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿã€‚åœ¨è¿™ä¸ªæ–°å‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œcontrollerçš„è®¾è®¡æ€è·¯é©±åŠ¨äº†æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œã€‚controllerçš„æŠ½è±¡è§£é‡Šå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
ç”±äºKubernetesè‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼ŒKubernetesè®¾è®¡äº†ä¸€ç§è‡ªå®šä¹‰èµ„æºCRDçš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥è‡ªå·±å®šä¹‰å„ç§èµ„æºï¼Œå¹¶å€ŸåŠ©ä¸€äº›frameworkå¼€å‘controllerï¼Œä½¿ç”¨controllerå°†æˆ‘ä»¬çš„æœŸæœ›å˜æˆç°å®ã€‚
åŸºäºè¿™ä¸ªæ€è·¯ï¼Œå¯¹äºæ—¥å¿—é‡‡é›†æ¥è¯´ï¼Œä¸€ä¸ªæœåŠ¡éœ€è¦é‡‡é›†å“ªäº›æ—¥å¿—ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„æ—¥å¿—é…ç½®ï¼Œæ˜¯ç”¨æˆ·çš„æœŸæœ›ï¼Œè€Œè¿™ä¸€åˆ‡ï¼Œå°±éœ€è¦æˆ‘ä»¬å¼€å‘ä¸€ä¸ªæ—¥å¿—é‡‡é›†çš„controllerå»å®ç°ã€‚
ä¸‰ã€æ¢ç´¢ä¸æ¶æ„è®¾è®¡ æœ‰äº†ä¸Šé¢çš„è§£å†³æ€è·¯ï¼Œé™¤äº†å¼€å‘ä¸€ä¸ªcontrollerï¼Œå‰©ä¸‹çš„å°±æ˜¯å›´ç»•ç€è¿™ä¸ªæ€è·¯çš„ä¸€äº›é€‰å‹åˆ†æã€‚
æ—¥å¿—é‡‡é›†agenté€‰å‹ æ—¥å¿—é‡‡é›†controlleråªè´Ÿè´£å¯¹æ¥Kubernetesï¼Œç”Ÿæˆé‡‡é›†é…ç½®ï¼Œå¹¶ä¸è´Ÿè´£çœŸæ­£çš„æ—¥å¿—é‡‡é›†ã€‚ç›®å‰å¸‚é¢ä¸Šçš„æ—¥å¿—é‡‡é›†agentæœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ä¼ ç»ŸELKæŠ€æœ¯æ ˆçš„Logstashï¼ŒCNCFå·²æ¯•ä¸šé¡¹ç›®Fluentdï¼Œæœ€è¿‘æ¨å‡ºä¸ä¹…çš„Lokiï¼Œè¿˜æœ‰beatsç³»åˆ—çš„Filebeatã€‚ ä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹ã€‚
 LogstashåŸºäºJVMï¼Œåˆ†åˆ†é’Ÿå†…å­˜å ç”¨è¾¾åˆ°å‡ ç™¾MBç”šè‡³ä¸ŠGBï¼Œæœ‰ç‚¹é‡ï¼Œé¦–å…ˆè¢«æˆ‘ä»¬æ’é™¤ã€‚ FluentdèƒŒé CNCFçœ‹ç€ä¸é”™ï¼Œå„ç§æ’ä»¶ä¹Ÿå¤šï¼Œä¸è¿‡åŸºäºRubyå’ŒCç¼–å†™ï¼Œå¯¹äºæˆ‘ä»¬å›¢é˜Ÿçš„æŠ€æœ¯æ ˆæ¥è¯´ï¼Œè¿˜æ˜¯è®©äººæ­¢äºè§‚æœ›ã€‚è™½ç„¶Fluentdè¿˜æ¨å‡ºäº†å­˜ç²¹åŸºäºCè¯­è¨€çš„Fluentd-bité¡¹ç›®ï¼Œå†…å­˜å ç”¨å¾ˆå°ï¼Œçœ‹ç€ååˆ†è¯±æƒ‘ï¼Œä½†æ˜¯ä½¿ç”¨Cè¯­è¨€å’Œä¸èƒ½åŠ¨æ€reloadé…ç½®ï¼Œè¿˜æ˜¯æ— æ³•ä»¤äººäº²è¿‘ã€‚ Lokiæ¨å‡ºçš„æ—¶é—´ä¸ä¹…ï¼Œç›®å‰è¿˜æ˜¯åŠŸèƒ½æœ‰é™ï¼Œè€Œä¸”ä¸€äº›å‹æµ‹æ•°æ®è¡¨æ˜æ€§èƒ½ä¸å¤ªå¥½ï¼Œæš‚æŒè§‚æœ›ã€‚ Filebeatå’ŒLogstashã€Kibanaã€ElasticsearchåŒå±Elasticå…¬å¸ï¼Œè½»é‡çº§æ—¥å¿—é‡‡é›†agentï¼Œæ¨å‡ºå°±æ˜¯ä¸ºäº†æ›¿æ¢Logstashï¼ŒåŸºäºGolangç¼–å†™ï¼Œå’Œæˆ‘ä»¬å›¢é˜ŸæŠ€æœ¯æ ˆå®Œç¾å¥‘åˆï¼Œå®æµ‹ä¸‹æ¥ä¸ªæ–¹é¢æ€§èƒ½ã€èµ„æºå ç”¨ç‡éƒ½æ¯”è¾ƒä¼˜ç§€ï¼Œäºæ˜¯æˆä¸ºäº†æˆ‘ä»¬æ—¥å¿—é‡‡é›†agentç¬¬ä¸€é€‰æ‹©ã€‚  agenté›†æˆæ–¹å¼ å¯¹äºæ—¥å¿—é‡‡é›†agentï¼Œåœ¨Kubernetesç¯å¢ƒä¸‹ä¸€èˆ¬æœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ã€‚
 ä¸€ç§ä¸ºsidecarçš„æ–¹å¼ï¼Œå³å’Œä¸šåŠ¡containeréƒ¨ç½²åœ¨åŒä¸€ä¸ªPodé‡Œï¼Œè¿™ç§æ–¹å¼ä¸‹ï¼ŒFilebeatåªé‡‡é›†è¯¥ä¸šåŠ¡containerçš„æ—¥å¿—ï¼Œä¹Ÿåªéœ€é…ç½®è¯¥containerçš„æ—¥å¿—é…ç½®ï¼Œç®€å•ã€éš”ç¦»æ€§å¥½ï¼Œä½†æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œ æ¯ä¸ªæœåŠ¡éƒ½è¦æœ‰ä¸€ä¸ªFilebeatå»é‡‡é›†ï¼Œé€šå¸¸ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæœ‰å¾ˆå¤šçš„Podï¼ŒåŠ èµ·æ¥çš„å†…å­˜ç­‰å¼€é”€ä¸å®¹ä¹è§‚ã€‚ å¦å¤–ä¸€ç§ä¹Ÿæ˜¯æœ€å¸¸è§çš„æ¯ä¸ªNodeä¸Šéƒ¨ç½²ä¸€ä¸ªFilebeatå®¹å™¨ï¼Œç›¸æ¯”è€Œè¨€ï¼Œå†…å­˜å ç”¨ä¸€èˆ¬è¦å°å¾ˆå¤šï¼Œè€Œä¸”å¯¹Podæ— ä¾µå…¥æ€§ï¼Œæ¯”è¾ƒç¬¦åˆæˆ‘ä»¬çš„å¸¸è§„ä½¿ç”¨æ–¹å¼ã€‚åŒæ—¶ä¸€èˆ¬ä½¿ç”¨Kubernetesçš„DaemonSetéƒ¨ç½²ï¼Œå…å»äº†ä¼ ç»Ÿçš„ç±»ä¼¼Ansibleç­‰è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼Œéƒ¨ç½²è¿ç»´æ•ˆç‡å¤§å¤§æå‡ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨Daemonsetéƒ¨ç½²Filebeatçš„æ–¹å¼ã€‚  æ•´ä½“æ¶æ„ é€‰æ‹©Filebeatä½œä¸ºæ—¥å¿—é‡‡é›†agentï¼Œé›†æˆäº†è‡ªç ”çš„æ—¥å¿—controlleråï¼Œä»èŠ‚ç‚¹çš„è§†è§’ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š
 æ—¥å¿—å¹³å°ä¸‹å‘å…·ä½“çš„CRDå®ä¾‹åˆ°Kubernetesé›†ç¾¤ä¸­ï¼Œæ—¥å¿—controller Rippleåˆ™è´Ÿè´£ä»Kubernetesä¸­List&amp;Watch Podå’ŒCRDå®ä¾‹ã€‚ é€šè¿‡Rippleçš„è¿‡æ»¤ã€èšåˆæœ€ç»ˆç”Ÿæˆä¸€ä¸ªFilebeatçš„inputé…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶é‡Œæè¿°äº†æœåŠ¡çš„é‡‡é›†Pathè·¯å¾„ã€å¤šè¡Œæ—¥å¿—åŒ¹é…ç­‰é…ç½®ï¼ŒåŒæ—¶è¿˜ä¼šé»˜è®¤æŠŠä¾‹å¦‚PodNameã€Hostnameç­‰é…ç½®åˆ°æ—¥å¿—å…ƒä¿¡æ¯ä¸­ã€‚ Filebeatåˆ™æ ¹æ®Rippleç”Ÿæˆçš„é…ç½®ï¼Œè‡ªåŠ¨reloadå¹¶é‡‡é›†èŠ‚ç‚¹ä¸Šçš„æ—¥å¿—ï¼Œå‘é€è‡³Kafkaæˆ–è€…Elasticsearchç­‰ã€‚  ç”±äºRippleç›‘å¬äº†Kubernetesäº‹ä»¶ï¼Œå¯ä»¥æ„ŸçŸ¥åˆ°Podçš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸ç®¡Podé”€æ¯è¿˜æ˜¯è°ƒåº¦åˆ°ä»»æ„çš„èŠ‚ç‚¹ï¼Œä¾ç„¶èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„Filebeaté…ç½®ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚
Rippleèƒ½æ„ŸçŸ¥åˆ°PodæŒ‚è½½çš„æ—¥å¿—Volumeï¼Œä¸ç®¡æ˜¯docker Stdoutçš„æ—¥å¿—ï¼Œè¿˜æ˜¯ä½¿ç”¨HostPathã€EmptyDirã€Pvå­˜å‚¨æ—¥å¿—ï¼Œå‡å¯ä»¥ç”ŸæˆèŠ‚ç‚¹ä¸Šçš„æ—¥å¿—è·¯å¾„ï¼Œå‘ŠçŸ¥Filebeatå»é‡‡é›†ã€‚
Rippleå¯ä»¥åŒæ—¶è·å–CRDå’ŒPodçš„ä¿¡æ¯ï¼Œæ‰€ä»¥é™¤äº†é»˜è®¤ç»™æ—¥å¿—é…ç½®åŠ ä¸ŠPodNameç­‰å…ƒä¿¡æ¯å¤–ï¼Œè¿˜å¯ä»¥ç»“åˆå®¹å™¨ç¯å¢ƒå˜é‡ã€Pod labelã€Pod Annotationç­‰ç»™æ—¥å¿—æ‰“æ ‡ï¼Œæ–¹ä¾¿åç»­æ—¥å¿—çš„è¿‡æ»¤ã€æ£€ç´¢æŸ¥è¯¢ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ç»™RippleåŠ å…¥äº†æ—¥å¿—å®šæ—¶æ¸…ç†ï¼Œç¡®ä¿æ—¥å¿—ä¸ä¸¢å¤±ç­‰åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥å¢å¼ºäº†æ—¥å¿—é‡‡é›†çš„åŠŸèƒ½å’Œç¨³å®šæ€§ã€‚
å››ã€åŸºäºFilebeatçš„å®è·µ åŠŸèƒ½æ‰©å±• ä¸€èˆ¬æƒ…å†µä¸‹Filebeatå¯æ»¡è¶³å¤§éƒ¨åˆ†çš„æ—¥å¿—é‡‡é›†éœ€æ±‚ï¼Œä½†æ˜¯ä»ç„¶é¿å…ä¸äº†ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯éœ€è¦æˆ‘ä»¬å¯¹Filebeatè¿›è¡Œå®šåˆ¶åŒ–å¼€å‘ï¼Œå½“ç„¶Filebeatæœ¬èº«çš„è®¾è®¡ä¹Ÿæä¾›äº†è‰¯å¥½çš„æ‰©å±•æ€§ã€‚ Filebeatç›®å‰åªæä¾›äº†åƒelasticsearchã€Kafkaã€logstashç­‰å‡ ç±»outputå®¢æˆ·ç«¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦Filebeatç›´æ¥å‘é€è‡³å…¶ä»–åç«¯ï¼Œéœ€è¦å®šåˆ¶åŒ–å¼€å‘è‡ªå·±çš„outputã€‚åŒæ ·ï¼Œå¦‚æœéœ€è¦å¯¹æ—¥å¿—åšè¿‡æ»¤å¤„ç†æˆ–è€…å¢åŠ å…ƒä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è‡ªåˆ¶processoræ’ä»¶ã€‚ æ— è®ºæ˜¯å¢åŠ outputè¿˜æ˜¯å†™ä¸ªprocessorï¼ŒFilebeatæä¾›çš„å¤§ä½“æ€è·¯åŸºæœ¬ç›¸åŒã€‚ä¸€èˆ¬æ¥è®²æœ‰3ç§æ–¹å¼ï¼š
 ç›´æ¥fork Filebeatï¼Œåœ¨ç°æœ‰çš„æºç ä¸Šå¼€å‘ã€‚outputæˆ–è€…processoréƒ½æä¾›äº†ç±»ä¼¼Runã€Stopç­‰çš„æ¥å£ï¼Œåªéœ€è¦å®ç°è¯¥ç±»æ¥å£ï¼Œç„¶ååœ¨initæ–¹æ³•ä¸­æ³¨å†Œç›¸åº”çš„æ’ä»¶åˆå§‹åŒ–æ–¹æ³•å³å¯ã€‚å½“ç„¶ï¼Œç”±äºGolangä¸­initæ–¹æ³•æ˜¯åœ¨importåŒ…æ—¶æ‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆå§‹åŒ–Filebeatçš„ä»£ç ä¸­æ‰‹åŠ¨importã€‚ å¤åˆ¶ä¸€ä»½Filebeatçš„main.goï¼Œimportæˆ‘ä»¬è‡ªç ”çš„æ’ä»¶åº“ï¼Œç„¶åé‡æ–°ç¼–è¯‘ã€‚æœ¬è´¨ä¸Šå’Œæ–¹å¼1åŒºåˆ«ä¸å¤§ã€‚ Filebeatè¿˜æä¾›äº†åŸºäºGolang pluginçš„æ’ä»¶æœºåˆ¶ï¼Œéœ€è¦æŠŠè‡ªç ”çš„æ’ä»¶ç¼–è¯‘æˆ.soå…±äº«é“¾æ¥åº“ï¼Œç„¶ååœ¨Filebeatå¯åŠ¨å‚æ•°ä¸­é€šè¿‡-pluginæŒ‡å®šåº“æ‰€åœ¨è·¯å¾„ã€‚ä¸è¿‡å®é™…ä¸Šä¸€æ–¹é¢Golang pluginè¿˜ä¸å¤Ÿæˆç†Ÿç¨³å®šï¼Œä¸€æ–¹é¢è‡ªç ”çš„æ’ä»¶ä¾ç„¶éœ€è¦ä¾èµ–ç›¸åŒç‰ˆæœ¬çš„libbeatåº“ï¼Œè€Œä¸”è¿˜éœ€è¦ç›¸åŒçš„Golangç‰ˆæœ¬ç¼–è¯‘ï¼Œå‘å¯èƒ½æ›´å¤šï¼Œä¸å¤ªæ¨èã€‚]]></description>
</item><item>
    <title>Knativeå…¨é“¾è·¯æµé‡æœºåˆ¶æ¢ç´¢ä¸æ­ç§˜</title>
    <link>http://example.org/posts/serverless/knative%E5%85%A8%E9%93%BE%E8%B7%AF%E6%B5%81%E9%87%8F%E6%9C%BA%E5%88%B6%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%8F%AD%E7%A7%98/</link>
    <pubDate>Sat, 07 Mar 2020 09:51:34 &#43;0800</pubDate>
    <author>Author</author>
    <guid>http://example.org/posts/serverless/knative%E5%85%A8%E9%93%BE%E8%B7%AF%E6%B5%81%E9%87%8F%E6%9C%BA%E5%88%B6%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%8F%AD%E7%A7%98/</guid>
    <description><![CDATA[å¼•å­â€”â€”ä»è‡ªåŠ¨æ‰©ç¼©å®¹è¯´èµ· æœåŠ¡æ¥æ”¶åˆ°æµé‡è¯·æ±‚åï¼Œä»0è‡ªåŠ¨æ‰©å®¹ä¸ºNï¼Œä»¥åŠæ²¡æœ‰æµé‡æ—¶è‡ªåŠ¨ç¼©å®¹ä¸º0ï¼Œæ˜¯Serverlesså¹³å°æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç‰¹å¾ã€‚
å¯ä»¥è¯´ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹æœºåˆ¶æ˜¯é‚£é¢—çš‡å† ï¼Œæˆ´ä¸Šä¹‹åæ‰èƒ½è¢«ç§°ä¹‹ä¸ºServerlessã€‚
å½“ç„¶äº†è§£Kubernetesçš„äººä¼šæœ‰ç–‘é—®ï¼ŒHPAä¸å°±æ˜¯ç”¨æ¥å¹²è‡ªåŠ¨æ‰©ç¼©å®¹çš„äº‹å„¿çš„å—ï¼Ÿéš¾é“æˆ‘ç”¨äº†HPAå°±å¯ä»¥æ‘‡èº«ä¸€å˜æˆä¸ºServerlessäº†ã€‚
è¿™é‡Œæœ‰ä¸€ç‚¹å…³é”®çš„åŒºåˆ«åœ¨äºï¼ŒServerlessè¯­ä¹‰ä¸‹çš„è‡ªåŠ¨æ‰©ç¼©å®¹æ˜¯å¯ä»¥è®©æœåŠ¡ä»0åˆ°Nçš„ï¼Œä½†æ˜¯HPAä¸èƒ½ã€‚HPAçš„æœºåˆ¶æ˜¯æ£€æµ‹æœåŠ¡Podçš„metricsæ•°æ®ï¼ˆä¾‹å¦‚CPUç­‰ï¼‰ç„¶åæŠŠDeploymentæ‰©å®¹ï¼Œä½†å½“ä½ æŠŠDeploymentå‰¯æœ¬æ•°ç½®ä¸º0æ—¶ï¼Œæµé‡è¿›ä¸æ¥ï¼Œmetricsæ•°æ®æ°¸è¿œä¸º0ï¼Œæ­¤æ—¶HPAä¹Ÿæ— èƒ½ä¸ºåŠ›ã€‚
æ‰€ä»¥HPAåªèƒ½è®©æœåŠ¡ä»1åˆ°Nï¼Œè€Œä»0åˆ°1çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œéœ€è¦é¢å¤–çš„æœºåˆ¶å¸®åŠ©holdä½è¯·æ±‚æµé‡ï¼Œæ‰©å®¹æœåŠ¡ï¼Œå†è½¬å‘æµé‡åˆ°æœåŠ¡ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å†·å¯åŠ¨ã€‚
å¯ä»¥è¯´ï¼Œå†·å¯åŠ¨æ˜¯Serverlessçš‡å† ä¸­çš„é‚£é¢—æ˜ç ï¼Œå¦‚ä½•å®ç°æ›´å¥½ã€æ›´å¿«çš„å†·å¯åŠ¨ï¼Œæ˜¯æ‰€æœ‰Serverlesså¹³å°æè‡´è¿½æ±‚çš„ç›®æ ‡ã€‚
Knativeä½œä¸ºç›®å‰è¢«ç¤¾åŒºå’Œå„å¤§å‚å•†å¦‚æ­¤é‡è§†å’Œå—å…³æ³¨çš„Serverlesså¹³å°ï¼Œå½“ç„¶ä¹Ÿåœ¨ä¸é—ä½™åŠ›çš„ä¼˜åŒ–è‡ªåŠ¨æ‰©ç¼©å®¹å’Œå†·å¯åŠ¨åŠŸèƒ½ã€‚
ä¸è¿‡ï¼Œæœ¬æ–‡å¹¶ä¸æ‰“ç®—ç›´æ¥ä»‹ç»Knativeè‡ªåŠ¨æ‰©ç¼©å®¹æœºåˆ¶ï¼Œè€Œæ˜¯å…ˆæ¢ç©¶ä¸€ä¸‹Knativeä¸­çš„æµé‡å®ç°æœºåˆ¶ï¼Œæµé‡æœºåˆ¶å’Œè‡ªåŠ¨æ‰©å®¹å¯†åˆ‡ç›¸å…³ï¼Œåªæœ‰äº†è§£å…¶ä¸­çš„å¥¥ç§˜ï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£Knative autoscaleåŠŸèƒ½ã€‚
ç”±äºKnativeå…¶å®åŒ…æ‹¬Building(Tekton)ã€Servingå’ŒEventingï¼Œè¿™é‡Œåªä¸“æ³¨äºServingéƒ¨åˆ†ã€‚ å¦å¤–éœ€è¦æå‰è¯´æ˜çš„æ˜¯ï¼ŒKnativeå¹¶ä¸å¼ºä¾èµ–Istioï¼ŒServerlessç½‘å…³çš„å®é™…é€‰æ‹©é™¤äº†é›†æˆIstioï¼Œè¿˜æ”¯æŒGlooã€Ambassadorç­‰ã€‚åŒæ—¶ï¼Œå³ä½¿ä½¿ç”¨äº†Istioï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨envoy sidecaræ³¨å…¥ã€‚æœ¬æ–‡ä»‹ç»çš„æ—¶å€™ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯Istioå’Œæ³¨å…¥sidecarçš„éƒ¨ç½²æ–¹å¼ã€‚
ç®€å•ä½†æ˜¯æœ‰ç‚¹è¿‡æ—¶çš„è€ç‰ˆæµé‡æœºåˆ¶ æ•´ä½“æ¶æ„å›é¡¾ å…ˆå›é¡¾ä¸€ä¸‹Knativeå®˜æ–¹çš„ä¸€ä¸ªç®€å•çš„åŸç†ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚ç”¨æˆ·åˆ›å»ºä¸€ä¸ªKnative Serviceï¼ˆksvcï¼‰åï¼ŒKnativeä¼šè‡ªåŠ¨åˆ›å»ºRouteï¼ˆrouteï¼‰ã€Configurationï¼ˆcfgï¼‰èµ„æºï¼Œç„¶åcfgä¼šåˆ›å»ºå¯¹åº”çš„Revisionï¼ˆrevï¼‰ç‰ˆæœ¬ã€‚revå®é™…ä¸Šåˆä¼šåˆ›å»ºDeploymentæä¾›æœåŠ¡ï¼Œæµé‡æœ€ç»ˆä¼šæ ¹æ®routeçš„é…ç½®ï¼Œå¯¼å…¥åˆ°ç›¸åº”çš„revä¸­ã€‚
è¿™æ˜¯ç®€å•çš„CRDè§†è§’ï¼Œå®é™…ä¸ŠKnativeçš„å†…éƒ¨CRDä¼šå¤šä¸€äº›å±‚æ¬¡ç»“æ„ï¼Œç›¸å¯¹æ›´å¤æ‚ä¸€ç‚¹ã€‚ä¸‹æ–‡ä¼šè¯¦ç»†æè¿°ã€‚
å†·å¯åŠ¨æ—¶çš„æµé‡è½¬å‘ ä»å†·å¯åŠ¨å’Œè‡ªåŠ¨æ‰©ç¼©å®¹çš„å®ç°è§’åº¦ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ä¸‹å›¾ ã€‚ä»å›¾ä¸­å¯ä»¥å¤§æ¦‚çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªRouteå……å½“ç½‘å…³çš„è§’è‰²ï¼Œå½“æœåŠ¡å‰¯æœ¬æ•°ä¸º0æ—¶ï¼Œè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°Activatorç»„ä»¶ï¼ŒActivatorä¼šä¿æŒè¯·æ±‚ï¼ŒåŒæ—¶Autoscalerç»„ä»¶ä¼šè´Ÿè´£å°†å‰¯æœ¬æ•°æ‰©å®¹ï¼Œä¹‹åActivatorå†å°†è¯·æ±‚å¯¼å…¥åˆ°å®é™…çš„Podï¼Œå¹¶ä¸”åœ¨å‰¯æœ¬æ•°ä¸ä¸º0æ—¶ï¼ŒRouteä¼šç›´æ¥å°†æµé‡è´Ÿè½½å‡è¡¡åˆ°Podï¼Œä¸å†èµ°Activatorç»„ä»¶ã€‚è¿™ä¹Ÿæ˜¯Knativeå®ç°å†·å¯åŠ¨çš„ä¸€ä¸ªåŸºæœ¬æ€è·¯ã€‚
åœ¨é›†æˆä½¿ç”¨Istioéƒ¨ç½²æ—¶ï¼ŒRouteé»˜è®¤é‡‡ç”¨çš„æ˜¯Istio Ingress Gatewayå®ç°ï¼Œå¤§æ¦‚åœ¨Knative 0.6ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒRouteçš„æµé‡è½¬å‘æœ¬è´¨ä¸Šæ˜¯ç”±Istio virtualserviceï¼ˆvsï¼‰æ§åˆ¶ã€‚å‰¯æœ¬æ•°ä¸º0æ—¶ï¼Œvså¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­destinationæŒ‡å‘çš„æ˜¯Activatorç»„ä»¶ã€‚æ­¤æ—¶Activatorä¼šå¸®åŠ©è½¬å‘å†·å¯åŠ¨æ—¶çš„è¯·æ±‚ã€‚
apiVersion:networking.istio.io/v1alpha3kind:VirtualServicemetadata:name:route-f8c50d56-3f47-11e9-9a9a-08002715c9e6spec:gateways:- knative-ingress-gateway- meshhosts:- helloworld-go.default.example.com- helloworld-go.default.svc.cluster.localhttp:- appendHeaders:route:- destination:host:Activator-Service.knative-serving.svc.cluster.localport:number:80weight:100å½“æœåŠ¡å‰¯æœ¬æ•°ä¸ä¸º0ä¹‹åï¼Œvså˜ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼Œå°†Ingress Gatewayçš„æµé‡ç›´æ¥è½¬å‘åˆ°æœåŠ¡Podä¸Šã€‚
apiVersion:networking.istio.io/v1alpha3kind:VirtualServicemetadata:name:route-f8c50d56-3f47-11e9-9a9a-08002715c9e6spec:hosts:- helloworld-go.default.example.com- helloworld-go.default.svc.cluster.localhttp:- match:route:- destination:host:helloworld-go-2xxcn-Service.default.svc.cluster.localport:number:80weight:100æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼ŒKnativeå°±æ˜¯é€šè¿‡ä¿®æ”¹vsçš„destination hostæ¥å®ç°å†·å¯åŠ¨ä¸­çš„æµé‡ä¿æŒå’Œè½¬å‘ã€‚
ç›¸ä¿¡ç›®å‰ä½ åœ¨ç½‘ä¸Šèƒ½æ‰¾åˆ°èµ„æ–™ï¼Œä¹ŸåŸºæœ¬ä¸Šåœç•™åœ¨è¯¥é˜¶æ®µã€‚ä¸è¿‡ï¼Œç”±äºKnativeçš„å¿«é€Ÿè¿­ä»£ï¼Œè¿™é‡Œçš„ä¸€äº›å®ç°ç»†èŠ‚åˆ†æå·²ç»è¿‡æ—¶ã€‚
ä¸‹é¢ä»¥0.9ç‰ˆæœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä»”ç»†æ¢ç©¶ä¸€ä¸‹ç°æœ‰çš„å®ç°æ–¹å¼ï¼Œå’Œå…³äºKnativeæµé‡çš„çœŸæ­£ç§˜å¯†ã€‚
å¤æ‚ä½†æ˜¯æ›´ä¼˜å¼‚çš„æ–°ç‰ˆæµé‡æœºåˆ¶ é‰´äºå®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æœ€æ–°çš„å…·ä½“å®ç°æœºåˆ¶ä»‹ç»ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„hello-go ksvcï¼Œå¹¶ä»¥æ­¤è¿›è¡Œåˆ†æã€‚ksvcå¦‚ä¸‹æ‰€ç¤ºï¼š
apiVersion: serving.knative.dev/v1alpha1 kind: Service metadata: name: hello-go namespace: faas spec: template: spec: containers: - image: harbor-yx-jd-dev.yx.netease.com/library/helloworld-go:v0.1 env: - name: TARGET value: &quot;Go Sample v1&quot; virtualserviceçš„å˜åŒ– ç¬”è€…çš„ç¯å¢ƒå¯ç®€å•çš„è®¤ä¸ºæ˜¯ä¸€ä¸ªæ ‡å‡†çš„Istioéƒ¨ç½²ï¼ŒServerlessç½‘å…³ä¸ºIstio Ingress Gatewayï¼Œæ‰€ä»¥åˆ›å»ºå®Œksvcåï¼Œä¸ºäº†éªŒè¯æœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œéœ€è¦å‘é€httpè¯·æ±‚è‡³ç½‘å…³ã€‚Gatewayèµ„æºå·²ç»åœ¨éƒ¨ç½²Knativeçš„æ—¶å€™åˆ›å»ºï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒvsã€‚åœ¨æœåŠ¡å‰¯æœ¬æ•°ä¸º0çš„æ—¶å€™ï¼ŒKnativeæ§åˆ¶å™¨åˆ›å»ºçš„vså…³é”®é…ç½®å¦‚ä¸‹ï¼š]]></description>
</item><item>
    <title>KubernetesåŸç”ŸCICDå·¥å…·ï¼šTektonæ¢ç§˜ä¸ä¸Šæ‰‹å®è·µ</title>
    <link>http://example.org/posts/cicd/kubernetes%E5%8E%9F%E7%94%9Fcicd%E5%B7%A5%E5%85%B7tekton%E6%8E%A2%E7%A7%98%E4%B8%8E%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</link>
    <pubDate>Sun, 25 Aug 2019 20:36:15 &#43;0800</pubDate>
    <author>Author</author>
    <guid>http://example.org/posts/cicd/kubernetes%E5%8E%9F%E7%94%9Fcicd%E5%B7%A5%E5%85%B7tekton%E6%8E%A2%E7%A7%98%E4%B8%8E%E4%B8%8A%E6%89%8B%E5%AE%9E%E8%B7%B5/</guid>
    <description><![CDATA[å¼•å­ å¦‚æœæœ‰å…³æ³¨è¿‡Knativeç¤¾åŒºåŠ¨æ€çš„åŒå­¦ï¼Œå¯èƒ½ä¼šçŸ¥é“æœ€è¿‘å‘ç”Ÿäº†ä¸€ä»¶æ¯”è¾ƒå¤§çš„æ–°é—»ï¼Œä¸‰å¤§ç»„ä»¶ä¹‹ä¸€çš„buildé¡¹ç›®è¢«äººæäº†ä¸€ä¸ªå¾ˆæ®‹å¿çš„Proposalï¼ˆhttps://github.com/knative/build/issues/614ï¼‰ï¼Œå¹¶ä¸”ä¸“é—¨åœ¨é¡¹ç›®Readmeçš„å¼€å¤´åŠ äº†ä¸ªNOTEï¼š
Note  ğŸš¨ NOTE: There is an open proposal to deprecate this component in favor of Tekton Pipelines. If you are a new user, consider using Tekton Pipelines, or another tool, to build and release. If you use Knative Build today, please give feedback on the deprecation proposal.   è¿™ä¸ªProposalçš„ç›®çš„æ˜¯æƒ³è¦åºŸå¼ƒKnativeçš„buildæ¨¡å—ï¼ŒKnativeåªä¸“æ³¨åšserverlessï¼Œè€Œå°†buildæ¨¡å—ä»£è¡¨çš„CI/CDåŠŸèƒ½å…¨ç›˜äº¤å‡ºï¼Œè®©ç”¨æˆ·è‡ªå·±é€‰æ‹©åˆé€‚çš„CI/CDå·¥å…·ã€‚Knativeåªè´Ÿè´£å°†é•œåƒè¿è¡Œï¼ŒåŒæ—¶æä¾›serverlessç›¸å…³çš„äº‹ä»¶é©±åŠ¨ç­‰åŠŸèƒ½ï¼Œä¸å†å…³å¿ƒé•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚
è™½ç„¶ç›®å‰ä¸ºæ­¢ï¼Œè¯¥Proposalè¿˜åœ¨å¼€æ”¾å¾æ±‚ç¤¾åŒºçš„æ„è§ï¼Œä¸è¿‡ï¼Œä»ç•™è¨€æ¥çœ‹ï¼Œbuildæ¨¡å—æœªæ¥è¿˜æ˜¯å¤§æ¦‚ç‡ä¼šè¢«deprecateã€‚å› ä¸ºKnative buildçš„æ›¿ä»£è€…Tektonå·²ç»å±•éœ²å¤´è„šï¼Œè¡¨ç°å‡ºæ›´å¼ºå¤§çš„åŸºäºkubernetesçš„CI/CDèƒ½åŠ›ï¼ŒTektonçš„è®¾è®¡æ€è·¯å…¶å®ä¹Ÿæ˜¯æ¥æºäºKnative buildçš„ï¼Œç°æœ‰ç”¨æˆ·ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»buildè¿ç§»è‡³Tektonã€‚
Tektonæ˜¯ä»€ä¹ˆ Tektonæ˜¯ä¸€ä¸ªè°·æ­Œå¼€æºçš„kubernetesåŸç”ŸCI/CDç³»ç»Ÿï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»ï¼Œå¼€æºç¤¾åŒºä¹Ÿæ­£åœ¨å¿«é€Ÿçš„è¿­ä»£å’Œå‘å±•å£®å¤§ã€‚google cloudå·²ç»æ¨å‡ºäº†åŸºäºTektonçš„æœåŠ¡ï¼ˆhttps://cloud.google.com/Tekton/ï¼‰ã€‚
å…¶å®Tektonçš„å‰èº«æ˜¯Knativeçš„build-pipelineé¡¹ç›®ï¼Œä»åå­—å¯ä»¥çœ‹å‡ºè¿™ä¸ªé¡¹ç›®æ˜¯ä¸ºäº†ç»™buildæ¨¡å—å¢åŠ pipelineçš„åŠŸèƒ½ï¼Œä½†æ˜¯å¤§å®¶å‘ç°éšç€ä¸åŒçš„åŠŸèƒ½åŠ å…¥åˆ°Knative buildæ¨¡å—ä¸­ï¼Œbuildæ¨¡å—è¶Šæ¥è¶Šå˜å¾—åƒä¸€ä¸ªé€šç”¨çš„CI/CDç³»ç»Ÿï¼Œè¿™å·²ç»è„±ç¦»äº†Knative buildè®¾è®¡çš„åˆè¡·ï¼Œäºæ˜¯ï¼Œç´¢æ€§å°†build-pipelineå‰¥ç¦»å‡ºKnativeï¼Œæ‘‡èº«ä¸€å˜æˆä¸ºTektonï¼Œè€ŒTektonä¹Ÿä»æ­¤è‡´åŠ›äºæä¾›å…¨åŠŸèƒ½ã€æ ‡å‡†åŒ–çš„åŸç”ŸkubernetesCI/CDè§£å†³æ–¹æ¡ˆã€‚
Tektonè™½ç„¶è¿˜æ˜¯ä¸€ä¸ªæŒºæ–°çš„é¡¹ç›®ï¼Œä½†æ˜¯å·²ç»æˆä¸º Continuous Delivery Foundation (CDF) çš„å››ä¸ªåˆå§‹é¡¹ç›®ä¹‹ä¸€ï¼Œå¦å¤–ä¸‰ä¸ªåˆ™æ˜¯å¤§åé¼é¼çš„Jenkinsã€Jenkins Xã€Spinnakerï¼Œå®é™…ä¸ŠTektonè¿˜å¯ä»¥ä½œä¸ºæ’ä»¶é›†æˆåˆ°JenkinsXä¸­ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ è§‰å¾—Jenkinså¤ªé‡ï¼Œæ²¡å¿…è¦ç”¨Spinnakerè¿™ç§ä¸“æ³¨äºå¤šäº‘å¹³å°çš„CDï¼Œä¸ºäº†é¿å…å’ŒGitlabè€¦åˆä¸æƒ³ç”¨gitlab-ciï¼Œé‚£ä¹ˆTektonå€¼å¾—ä¸€è¯•ã€‚
Tektonçš„ç‰¹ç‚¹æ˜¯kubernetesåŸç”Ÿï¼Œä»€ä¹ˆæ˜¯kubernetesåŸç”Ÿå‘¢ï¼Ÿç®€å•çš„ç†è§£ï¼Œå°±æ˜¯all in kubernetesï¼Œæ‰€ä»¥ç”¨å®¹å™¨åŒ–çš„æ–¹å¼æ„å»ºå®¹å™¨é•œåƒæ˜¯å¿…ç„¶ï¼Œå¦å¤–ï¼ŒåŸºäºkubernetes CRDå®šä¹‰çš„pipelineæµæ°´çº¿ä¹Ÿæ˜¯Tektonæœ€é‡è¦çš„ç‰¹å¾ã€‚]]></description>
</item><item>
    <title>å®¹å™¨æ—¥å¿—é‡‡é›†åˆ©å™¨ï¼šFilebeatæ·±åº¦å‰–æä¸å®è·µ</title>
    <link>http://example.org/posts/logging/%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E5%88%A9%E5%99%A8filebeat%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E8%B7%B5/</link>
    <pubDate>Sat, 13 Jul 2019 10:12:46 &#43;0800</pubDate>
    <author>Author</author>
    <guid>http://example.org/posts/logging/%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E5%88%A9%E5%99%A8filebeat%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E8%B7%B5/</guid>
    <description><![CDATA[åœ¨äº‘åŸç”Ÿæ—¶ä»£å’Œå®¹å™¨åŒ–æµªæ½®ä¸­ï¼Œå®¹å™¨çš„æ—¥å¿—é‡‡é›†æ˜¯ä¸€ä¸ªçœ‹èµ·æ¥ä¸èµ·çœ¼å´åˆæ— æ³•å¿½è§†çš„é‡è¦è®®é¢˜ã€‚å¯¹äºå®¹å™¨æ—¥å¿—é‡‡é›†æˆ‘ä»¬å¸¸ç”¨çš„å·¥å…·æœ‰Filebeatå’ŒFluentdï¼Œä¸¤è€…å¯¹æ¯”å„æœ‰ä¼˜åŠ£ï¼Œç›¸æ¯”åŸºäºrubyçš„Fluentdï¼Œè€ƒè™‘åˆ°å¯å®šåˆ¶æ€§ï¼Œæˆ‘ä»¬ä¸€èˆ¬é»˜è®¤é€‰æ‹©golangæŠ€æœ¯æ ˆçš„Filebeatä½œä¸ºä¸»åŠ›çš„æ—¥å¿—é‡‡é›†agentã€‚
ç›¸æ¯”è¾ƒä¼ ç»Ÿçš„æ—¥å¿—é‡‡é›†æ–¹å¼ï¼Œå®¹å™¨åŒ–ä¸‹å•èŠ‚ç‚¹ä¼šè¿è¡Œæ›´å¤šçš„æœåŠ¡ï¼Œè´Ÿè½½ä¹Ÿä¼šæœ‰æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œè¿™äº›æ›´å®¹æ˜“å¯¹æ—¥å¿—é‡‡é›†agenté€ æˆå‹åŠ›ï¼Œè™½ç„¶Filebeatè¶³å¤Ÿè½»é‡çº§å’Œé«˜æ€§èƒ½ï¼Œä½†å¦‚æœä¸äº†è§£Filebeatçš„æœºåˆ¶ï¼Œä¸åˆç†çš„é…ç½®Filebeatï¼Œå®é™…çš„ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ä¸­å¯èƒ½ä¹Ÿä¼šç»™æˆ‘ä»¬å¸¦æ¥æ„æƒ³ä¸åˆ°çš„éº»çƒ¦å’Œéš¾é¢˜ã€‚
æ•´ä½“æ¶æ„ æ—¥å¿—é‡‡é›†çš„åŠŸèƒ½çœ‹èµ·æ¥ä¸å¤æ‚ï¼Œä¸»è¦åŠŸèƒ½æ— éå°±æ˜¯æ‰¾åˆ°é…ç½®çš„æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åè¯»å–å¹¶å¤„ç†ï¼Œå‘é€è‡³ç›¸åº”çš„åç«¯å¦‚elasticsearch,kafkaç­‰ã€‚
Filebeatå®˜ç½‘æœ‰å¼ ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
é’ˆå¯¹æ¯ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ŒFilebeatéƒ½ä¼šå¯åŠ¨ä¸€ä¸ªharvesteråç¨‹ï¼Œå³ä¸€ä¸ªgoroutineï¼Œåœ¨è¯¥goroutineä¸­ä¸åœçš„è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œç›´åˆ°æ–‡ä»¶çš„EOFæœ«å°¾ã€‚ä¸€ä¸ªæœ€ç®€å•çš„è¡¨ç¤ºé‡‡é›†ç›®å½•çš„inputé…ç½®å¤§æ¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š
filebeat.inputs:- type:log# Paths that should be crawled and fetched. Glob based paths.paths:- /var/log/*.logä¸åŒçš„harvester goroutineé‡‡é›†åˆ°çš„æ—¥å¿—æ•°æ®éƒ½ä¼šå‘é€è‡³ä¸€ä¸ªå…¨å±€çš„é˜Ÿåˆ—queueä¸­ï¼Œqueueçš„å®ç°æœ‰ä¸¤ç§ï¼šåŸºäºå†…å­˜å’ŒåŸºäºç£ç›˜çš„é˜Ÿåˆ—ï¼Œç›®å‰åŸºäºç£ç›˜çš„é˜Ÿåˆ—è¿˜æ˜¯å¤„äºalphaé˜¶æ®µï¼ŒFilebeaté»˜è®¤å¯ç”¨çš„æ˜¯åŸºäºå†…å­˜çš„ç¼“å­˜é˜Ÿåˆ—ã€‚
æ¯å½“é˜Ÿåˆ—ä¸­çš„æ•°æ®ç¼“å­˜åˆ°ä¸€å®šçš„å¤§å°æˆ–è€…è¶…è¿‡äº†å®šæ—¶çš„æ—¶é—´ï¼ˆé»˜è®¤1s)ï¼Œä¼šè¢«æ³¨å†Œçš„clientä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹ï¼Œå‘é€è‡³é…ç½®çš„åç«¯ã€‚ç›®å‰å¯ä»¥è®¾ç½®çš„clientæœ‰kafkaã€elasticsearchã€redisç­‰ã€‚
è™½ç„¶è¿™ä¸€åˆ‡çœ‹ç€æŒºç®€å•ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦è€ƒè™‘æ›´å¤šçš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š
 æ—¥å¿—æ–‡ä»¶æ˜¯å¦‚ä½•è¢«filbebeatå‘ç°åˆæ˜¯å¦‚ä½•è¢«é‡‡é›†çš„ï¼Ÿ Filebeatæ˜¯å¦‚ä½•ç¡®ä¿æ—¥å¿—é‡‡é›†å‘é€åˆ°è¿œç¨‹çš„å­˜å‚¨ä¸­ï¼Œä¸ä¸¢å¤±ä¸€æ¡æ•°æ®çš„ï¼Ÿ å¦‚æœFilebeatæŒ‚æ‰ï¼Œä¸‹æ¬¡é‡‡é›†å¦‚ä½•ç¡®ä¿ä»ä¸Šæ¬¡çš„çŠ¶æ€å¼€å§‹è€Œä¸ä¼šé‡æ–°é‡‡é›†æ‰€æœ‰æ—¥å¿—ï¼Ÿ Filebeatçš„å†…å­˜æˆ–è€…cpuå ç”¨è¿‡å¤šï¼Œè¯¥å¦‚ä½•åˆ†æè§£å†³ï¼Ÿ Filebeatå¦‚ä½•æ”¯æŒdockerå’Œkubernetesï¼Œå¦‚ä½•é…ç½®å®¹å™¨åŒ–ä¸‹çš„æ—¥å¿—é‡‡é›†ï¼Ÿ æƒ³è®©Filebeaté‡‡é›†çš„æ—¥å¿—å‘é€è‡³çš„åç«¯å­˜å‚¨ï¼Œå¦‚æœåŸç”Ÿä¸æ”¯æŒï¼Œæ€æ ·å®šåˆ¶åŒ–å¼€å‘ï¼Ÿ  è¿™äº›å‡éœ€è¦å¯¹Filebeatæœ‰æ›´æ·±å…¥çš„ç†è§£ï¼Œä¸‹é¢è®©æˆ‘ä»¬è·ŸéšFilebeatçš„æºç ä¸€èµ·æ¢ç©¶å…¶ä¸­çš„å®ç°æœºåˆ¶ã€‚
ä¸€æ¡æ—¥å¿—æ˜¯å¦‚ä½•è¢«é‡‡é›†çš„ Filebeatæºç å½’å±äºbeatsé¡¹ç›®ï¼Œè€Œbeatsé¡¹ç›®çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†é‡‡é›†å„ç±»çš„æ•°æ®ï¼Œæ‰€ä»¥beatsæŠ½è±¡å‡ºäº†ä¸€ä¸ªlibbeatåº“ï¼ŒåŸºäºlibbeatæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„å¼€å‘å®ç°ä¸€ä¸ªé‡‡é›†çš„å·¥å…·ï¼Œé™¤äº†Filebeatï¼Œè¿˜æœ‰åƒmetricbeatã€packetbeatç­‰å®˜æ–¹çš„é¡¹ç›®ä¹Ÿæ˜¯åœ¨beatså·¥ç¨‹ä¸­ã€‚
å¦‚æœæˆ‘ä»¬å¤§è‡´çœ‹ä¸€ä¸‹ä»£ç å°±ä¼šå‘ç°ï¼Œlibbeatå·²ç»å®ç°äº†å†…å­˜ç¼“å­˜é˜Ÿåˆ—memqueueã€å‡ ç§outputæ—¥å¿—å‘é€å®¢æˆ·ç«¯ï¼Œæ•°æ®çš„è¿‡æ»¤å¤„ç†processorç­‰é€šç”¨åŠŸèƒ½ï¼Œè€ŒFilebeatåªéœ€è¦å®ç°æ—¥å¿—æ–‡ä»¶çš„è¯»å–ç­‰å’Œæ—¥å¿—ç›¸å…³çš„é€»è¾‘å³å¯ã€‚
ä»ä»£ç çš„å®ç°è§’åº¦æ¥çœ‹ï¼ŒFilebeatå¤§æ¦‚å¯ä»¥åˆ†ä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼š
 input: æ‰¾åˆ°é…ç½®çš„æ—¥å¿—æ–‡ä»¶ï¼Œå¯åŠ¨harvester harvester: è¯»å–æ–‡ä»¶ï¼Œå‘é€è‡³spooler spooler: ç¼“å­˜æ—¥å¿—æ•°æ®ï¼Œç›´åˆ°å¯ä»¥å‘é€è‡³publisher publisher: å‘é€æ—¥å¿—è‡³åç«¯ï¼ŒåŒæ—¶é€šçŸ¥registrar registrar: è®°å½•æ—¥å¿—æ–‡ä»¶è¢«é‡‡é›†çš„çŠ¶æ€  1. æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶ å¯¹äºæ—¥å¿—æ–‡ä»¶çš„é‡‡é›†å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒFilebeatæŠ½è±¡å‡ºä¸€ä¸ªCrawlerçš„ç»“æ„ä½“ï¼Œ åœ¨Filebeatå¯åŠ¨åï¼Œcrawlerä¼šæ ¹æ®é…ç½®åˆ›å»ºï¼Œç„¶åéå†å¹¶è¿è¡Œæ¯ä¸ªinputï¼š
for _, inputConfig := range c.inputConfigs { err := c.startInput(pipeline, inputConfig, r.GetStates()) } åœ¨æ¯ä¸ªinputè¿è¡Œçš„é€»è¾‘é‡Œï¼Œé¦–å…ˆä¼šæ ¹æ®é…ç½®è·å–åŒ¹é…çš„æ—¥å¿—æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„åŒ¹é…æ–¹å¼å¹¶éæ­£åˆ™ï¼Œè€Œæ˜¯é‡‡ç”¨linux globçš„è§„åˆ™ï¼Œå’Œæ­£åˆ™è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«ã€‚
matches, err := filepath.Glob(path) è·å–åˆ°äº†æ‰€æœ‰åŒ¹é…çš„æ—¥å¿—æ–‡ä»¶ä¹‹åï¼Œä¼šç»è¿‡ä¸€äº›å¤æ‚çš„è¿‡æ»¤ï¼Œä¾‹å¦‚å¦‚æœé…ç½®äº†exclude_filesåˆ™ä¼šå¿½ç•¥è¿™ç±»æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šæŸ¥è¯¢æ–‡ä»¶çš„çŠ¶æ€ï¼Œå¦‚æœæ–‡ä»¶çš„æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ—¶é—´å¤§äºignore_olderçš„é…ç½®ï¼Œä¹Ÿä¼šä¸å»é‡‡é›†è¯¥æ–‡ä»¶ã€‚]]></description>
</item></channel>
</rss>
